# 多端同步功能设置指南

本指南将帮助你在 Vercel 上配置 KV 存储，实现 NavHub 的多端同步功能。

## 前提条件

- 项目已部署到 Vercel
- 拥有 Vercel 账号的管理权限

## 步骤 1：在 Vercel 中启用 KV 存储

1. 登录 [Vercel Dashboard](https://vercel.com/dashboard)
2. 选择你的 NavHub 项目
3. 点击顶部导航栏的 **Storage** 标签
4. 点击 **Create Database** 按钮
5. 选择 **KV** (Key-Value Store)
6. 输入数据库名称（例如：`navhub-sync`）
7. 选择区域（建议选择离你最近的区域）
8. 点击 **Create** 创建数据库

## 步骤 2：连接 KV 到项目

1. 创建完成后，Vercel 会自动将 KV 连接到你的项目
2. 环境变量会自动添加：
   - `KV_REST_API_URL`
   - `KV_REST_API_TOKEN`
   - `KV_REST_API_READ_ONLY_TOKEN`
   - `KV_URL`

## 步骤 3：重新部署项目

1. 在项目页面，点击 **Deployments** 标签
2. 点击最新部署右侧的三个点菜单
3. 选择 **Redeploy**
4. 确认重新部署

或者，直接推送新的代码到 Git 仓库触发自动部署。

## 步骤 4：使用同步功能

### 在第一台设备上启用同步

1. 打开部署后的 NavHub 应用
2. 点击左上角的云图标（同步按钮）
3. 输入一个 PIN 码（至少 4 个字符，例如：`1234` 或 `mypin2024`）
4. 点击 **Enable Sync** 按钮
5. 等待同步完成，你会看到成功提示

### 在其他设备上同步数据

1. 在另一台设备上打开 NavHub
2. 点击左上角的云图标
3. 输入**相同的 PIN 码**
4. 点击 **Enable Sync**
5. 应用会自动从云端拉取数据

## 功能说明

### 自动同步

- 启用同步后，每次添加、编辑或删除书签时，数据会自动上传到云端
- 使用防抖机制，避免频繁请求（1 秒延迟）

### 手动同步

- 点击同步模态框中的 **Sync Now** 按钮可以立即同步
- 适用于需要强制刷新数据的场景

### 同步状态指示

- 绿色圆点：同步已启用
- 旋转图标：正在同步中
- 最后同步时间显示在同步模态框中

### 禁用同步

1. 打开同步模态框
2. 点击 **Disable Sync** 按钮
3. 确认操作
4. 本地数据不会被删除，只是停止云端同步

## 安全性说明

### PIN 码安全

- PIN 码用于标识你的同步账户
- 建议使用至少 6 位的复杂 PIN 码
- 不要与他人分享你的 PIN 码
- 如果 PIN 码泄露，其他人可以访问你的书签数据

### 数据存储

- 数据存储在 Vercel KV 中，使用 PIN 码作为键
- 数据格式：`sync:{pin}:bookmarks` 和 `sync:{pin}:settings`
- 目前数据未加密，如需更高安全性，可以考虑在前端加密后再上传

## 故障排除

### 同步失败

1. 检查网络连接
2. 确认 Vercel KV 已正确配置
3. 查看浏览器控制台的错误信息
4. 尝试手动同步

### PIN 码忘记

- 如果忘记 PIN 码，无法恢复云端数据
- 可以使用新的 PIN 码重新启用同步
- 本地数据不会丢失

### 数据冲突

- 使用"最后写入优先"策略
- 如果多个设备同时修改，最后同步的数据会覆盖之前的数据
- 建议在一台设备上完成编辑后再切换到另一台设备

## 技术细节

### API 端点

- `GET /api/sync/get?pin={pin}` - 获取云端数据
- `POST /api/sync/save` - 保存数据到云端

### 数据结构

```typescript
{
  bookmarks: Bookmark[],
  settings: AppSettings,
  lastModified: number
}
```

### 本地存储键

- `navhub_sync_pin` - 存储 PIN 码
- `navhub_device_id` - 设备唯一标识
- `navhub_last_modified` - 最后修改时间戳

## 成本说明

Vercel KV 免费套餐包括：
- 256 MB 存储空间
- 每月 100,000 次读取
- 每月 1,000 次写入

对于个人使用的书签同步，免费套餐完全足够。

## 后续优化建议

1. **数据加密**：在前端使用 PIN 码派生密钥加密数据
2. **冲突解决**：实现更智能的合并策略
3. **版本控制**：保存历史版本，支持回滚
4. **多用户支持**：集成 OAuth 认证
5. **实时同步**：使用 WebSocket 实现实时推送

## 支持

如有问题，请在 GitHub 仓库提交 Issue。
